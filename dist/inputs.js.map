{"version":3,"sources":["../src/inputs.jsx"],"sourcesContent":["import React, { memo } from 'react';\nimport PropTypes from 'prop-types';\nimport { underscore } from './underscore';\n\nexport function* inputs({\n  value,\n  prefix = '',\n  depth = 0,\n  isArrayItem = false,\n  transform,\n}) {\n  let iterator = value;\n\n  if (!value[Symbol.iterator]) {\n    iterator = Object.entries(value);\n  }\n\n  let index = -1;\n  for (const next of iterator) {\n    index += 1;\n    let keepKey = false;\n    let property = index;\n    let item = next;\n\n    // An object or map will return [key, value] pairs\n    if (Array.isArray(next) && next.length === 2) {\n      [property, item] = next;\n    }\n\n    if (transform) {\n      const transformed = transform(property, item);\n      if (transformed === false) {\n        continue;\n      }\n      if (transformed) {\n        [property, item] = transform(property, item);\n        keepKey = true;\n      }\n    }\n\n    if (item === undefined) {\n      continue;\n    }\n\n    let name = prefix;\n    if (depth === 0) {\n      name += keepKey ? property : underscore(property);\n    } else if (isArrayItem) {\n      name += '[]';\n    } else {\n      name += `[${keepKey ? property : underscore(property)}]`;\n    }\n\n    let key = property;\n    if (isArrayItem) {\n      key += `_${index}`;\n    }\n\n    if ((Array.isArray(item) && item.length === 0) || (item instanceof Set && item.size === 0)) {\n      // For an empty array, include a default item for arrays so Rails will know they are empty\n      key = `${key}[]`;\n      name = `${name}[]`;\n      item = '';\n    } else if (item !== null && typeof item === 'object' && !(item instanceof Date)) {\n      yield (\n        <Inputs\n          value={item}\n          prefix={name}\n          depth={depth + 1}\n          isArrayItem={Array.isArray(item) || item instanceof Set}\n          key={key}\n          transform={transform}\n        />\n      );\n      continue;\n    } else if (Number.isNaN(item)) {\n      item = '';\n    } else if (item instanceof Date) {\n      item = item.toISOString();\n    } else if (typeof item === 'boolean') {\n      item = item ? '1' : '0';\n    } else {\n      item = String(item ?? '');\n    }\n\n    yield <input type=\"hidden\" key={key} name={name} value={item} />;\n  }\n}\n\nconst Inputs = memo((props) => [...inputs(props)]);\n\nInputs.propTypes = {\n  prefix: PropTypes.string.isRequired,\n  value: PropTypes.any.isRequired,\n  depth: PropTypes.number.isRequired,\n  isArrayItem: PropTypes.bool,\n};\n\nInputs.defaultProps = {\n  isArrayItem: false,\n};\n\nInputs.displayName = 'Inputs';\n"],"names":["React","memo","PropTypes","underscore","inputs","value","prefix","depth","isArrayItem","transform","iterator","Symbol","Object","entries","index","next","keepKey","property","item","Array","isArray","length","transformed","undefined","name","key","Set","size","Date","Inputs","Number","isNaN","toISOString","String","input","type","props","propTypes","string","isRequired","any","number","bool","defaultProps","displayName"],"mappings":"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"}